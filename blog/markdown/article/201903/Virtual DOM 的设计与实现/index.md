# Virtual DOM 的设计与实现

`Virtual DOM` 本质上来说是 javascript 对象，用来描述 `DOM` 结构以及其附加的`属性、状态、事件`等。

## 为什么要用 Virtual DOM

目前常见的 React，Vue 等前端框架，在设计上都使用了 `Virtual DOM`（下文中都简称`vdom`），旨在便于管理 dom，提高性能，以及添加跨平台能力。

### 统一管理 dom，提高性能

无需去记住复杂的 dom 操作方式，也不需要关心数据更新后哪些有变更。

`vdom` 封装了这一层，使用者只用更新自己的数据，生成一个新的 `vdom`，它会自己去找到其中差异的部分，进行更新、添加、删除等操作。 对 `dom` 的操作是昂贵的，`vdom` 作为一个缓冲层，使用者可以把自己对 `dom` 的期望表现在 `vdom` 上，最后在一个合适的时机去一次性更新真实 `dom`。

另一方面，提高性能并不是说使用 `vdom` 就比直接操作 `dom` 快。

"越封装越慢"，`vdom` 底层还是调用了普通的操作 dom 的相关 api，这里说的提高性能，说的是可能避免以下情况：

1. 多次操作 dom 后的结果可能跟最初相比没有差异，而如果使用 `vdom` 不会触发更新 dom。
2. 最终的 dom 跟原始 dom 有差异，而 `vdom` 会用最少的次数，尽可能的复用 dom 去达成目的以节约消耗，毕竟 dom 的操作非常昂贵。
3. ...想到再加

### 跨平台能力

上来就说过，`vdom` 是对 dom 的一种描述，本质是 javascript 对象，或者编译为其它语言的对象，那么换一种宿主环境，就可以让 `vdom` 在新的平台继续使用，比如去进行 `SSR(Server Side Render)` ，或者很出名的 `React Native`。

