# Service - 业务与 UI 分离

业务逻辑与 UI 分离，在服务端人士看来一般理所当然，似乎事情本来就应该这样。
但是在前端领域延伸出了另一条路：`UI组件` 和 `业务组件`。

- `UI组件`（基础组件） 负责提供基础展示、交互能力，拥有极大的复用性。
- `业务组件` 在 `UI组件` 的基础上，添加了定制化的展示，以及业务逻辑。通常很难复用。

业务会分散到多个、甚至多层次的组件中去，在业务复杂后应该还要找一个 `store` 来完成状态管理。
随着时间增加，UI 逻辑和业务逻辑纠缠不清，出现了 _跨层级传值_、_兄弟组件间传值_、_调用不相干组件间方法_ 等奇葩需求。

就像这样，点击一个删除按钮后，想让【List】执行 refresh 方法：

```
                                         ...

                                         ▲
  ┌──────────┐      ┌────────────┐       │             ┌────────────┐
  │          │      │            ├───────┘             │            │
  │          ├─────►│            ├─────► ...  ────────►│   Delele   │
  │          │      └────────────┘                     └──────┬─────┘
  │          │                                                │
  │   Page   │      ┌────────────┐                            │
  │          │      │            │                            │
  │          ├─────►│    List    │◄─────── refresh ◄──────────┘
  │          │      │            │
  └──────────┘      └────────────┘

```

## 常规的解决方案

为此前端延伸出一系列解决方案和概念，`状态管理`、`EventBus`、`单向数据流`、`时间旅行`、`balabala`...
甚至 redux 已经出现了辅助生成 `Action Type` 的库，这类为了解决问题而引入了新问题，让前端异常繁荣。

`EventBus` 是 pub/sub 模式下的产物，应用广泛，可靠而有效。缺点就是用起来很丑陋，很难接受 `EventKey` 使用字面量，引入常量也没有很大程度解决问题，反而会带来一些成本。如果未能妥善释放也会给内存造成很大的压力。

`类flux状态管理` 推崇的是集中管理状态，可以用一个状态，概括一组组件，甚至一个应用的整体状态。
因此它是全局的，不适合 ui 组件，也不好解决内存持久不能释放等问题。

> 概括起来就是，我对现有方法有意见，觉得他们用起来很麻烦，也不能解决问题，还会带来新的问题。

## 业务与 UI 分离

业务如果拆分到太多组件中去，那么除了写这部分代码的人，很难对整个业务有个直观的感受，不清楚这个业务是做什么的，
如果想对现有业务进行调整，也有可能影响业务中，某个自己不熟悉的部分。另外跨多层级传递数据、调用方法会非常麻烦。

> 我的想法是，把业务与 UI 分离，业务本身就不应该写到组件中去，业务有自己的 `数据`、`方法`，就像传统架构中的 `service` 层，
> 而组件只是把业务中的数据展示出来，或者调用下业务的方法，像 `UI层` 一样。

这样带来的好处显而易见，

1. 直接在 `service` 中就可以完成所有的业务逻辑，无需等待 ui 稿完成。甚至业务跟 ui 可以交给 2 个人去并行开发，提高生产力。
2. 集中式的数据、业务管理，可以最直观的快速了解当前所有功能，把控业务流程。
3. 不需要 `props`、`emit`、`event`，所有数据都在 service 层，也就不存在（多层级、未知层级的）组件间传值、调用的 case 了。
4. 不需要复杂的概念，也不要复杂的使用方式。状态管理本身就不需要那么复杂。

举个例子：

```html
<!-- vue 为例子，某个搜索的业务 -->
<input v-model="service.state.searchModel" @mousedown.enter="service.search()" />
```

> 没错，业务应该由【数据】和【行为】组成，这部分没必要放进组件（vue/react/ng）中。
> 如果你觉得这个想法没问题，那么往下看咱们聊聊实现方式。
